<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ShopLocate - Recommended Locations</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root {
            --primary: #3498db;
            --success: #28a745;
            --warning: #ffc107;
            --danger: #dc3545;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        .map-container {
            border: 1px solid #ddd;
            border-radius: 8px;
            overflow: hidden;
            margin-bottom: 2rem;
            min-height: 400px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        .map-static {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .card {
            transition: all 0.3s ease;
            border: none;
            border-radius: 8px;
            overflow: hidden;
            margin-bottom: 20px;
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }
        
        .competition-badge {
            position: absolute;
            top: 10px;
            right: 10px;
        }
        
        .hidden-location {
            display: none;
        }
        
        #seeMoreBtn {
            transition: all 0.3s ease;
        }
        
        #seeMoreBtn.collapsed .when-expanded {
            display: none;
        }
        
        #seeMoreBtn:not(.collapsed) .when-collapsed {
            display: none;
        }
    </style>
</head>
<body>
    <header>
        <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="index.html">ShopLocate</a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarNav">
                    <ul class="navbar-nav ms-auto">
                        <li class="nav-item"><a class="nav-link" href="index.html">Home</a></li>
                        <li class="nav-item"><a class="nav-link" href="index.html#how-it-works">How It Works</a></li>
                        <li class="nav-item"><a class="nav-link" href="index.html#about">About</a></li>
                        <li class="nav-item"><a class="nav-link" href="index.html#contact">Contact</a></li>
                    </ul>
                </div>
            </div>
        </nav>
    </header>

    <main class="container my-5">
        <div class="row mb-4 align-items-end">
            <div class="col-md-8">
                <h1 id="resultsHeading" class="mb-1">Recommended Locations</h1>
                <p id="searchCriteria" class="text-muted"></p>
            </div>
            <div class="col-md-4 text-md-end">
                <a href="index.html" class="btn btn-outline-primary">
                    <i class="fas fa-search"></i> New Search
                </a>
            </div>
        </div>

        <div class="map-container shadow-lg mb-5">
            <div id="resultsMap" class="h-100">
                <div class="map-placeholder d-flex flex-column align-items-center justify-content-center h-100">
                    <i class="fas fa-map-marked-alt fa-4x mb-3 text-primary"></i>
                    <p>Loading competition analysis...</p>
                </div>
            </div>
        </div>

        <h3 class="mb-4">Top Locations with Least Competition</h3>
        <div class="row" id="resultsContainer">
            <!-- First 3 locations will load here -->
        </div>

        <div class="row mt-3">
            <div class="col-12 text-center">
                <button id="seeMoreBtn" class="btn btn-primary collapsed" 
                        type="button" data-bs-toggle="collapse" 
                        data-bs-target="#moreLocations" aria-expanded="false" 
                        aria-controls="moreLocations">
                    <span class="when-collapsed">
                        <i class="fas fa-chevron-down me-2"></i>Show More Locations
                    </span>
                    <span class="when-expanded">
                        <i class="fas fa-chevron-up me-2"></i>Show Fewer Locations
                    </span>
                </button>
            </div>
        </div>

        <div class="row collapse" id="moreLocations">
            <div class="col-12">
                <div class="row" id="moreResultsContainer">
                    <!-- Additional locations will load here -->
                </div>
            </div>
        </div>

        <div class="card mt-4">
            <div class="card-body">
                <h5><i class="fas fa-lightbulb me-2"></i>How We Calculate Competition</h5>
                <ul class="mb-0">
                    <li>We count all similar businesses within 1km radius</li>
                    <li>Locations are sorted by fewest competitors first</li>
                    <li>Only areas with good foot traffic are recommended</li>
                    <li>Rent estimates consider local competition levels</li>
                </ul>
            </div>
        </div>
    </main>

    <footer class="bg-dark text-white py-5">
        <div class="container">
            <div class="row">
                <div class="col-md-4 mb-4">
                    <h5>ShopLocate</h5>
                    <p>Data-driven location analysis for your business.</p>
                </div>
                <div class="col-md-4 mb-4">
                    <h5>Quick Links</h5>
                    <ul class="list-unstyled">
                        <li><a href="index.html" class="text-white">Home</a></li>
                        <li><a href="index.html#how-it-works" class="text-white">How It Works</a></li>
                        <li><a href="index.html#about" class="text-white">About</a></li>
                        <li><a href="index.html#contact" class="text-white">Contact</a></li>
                    </ul>
                </div>
                <div class="col-md-4 mb-4">
                    <h5>Need Help?</h5>
                    <p><i class="fas fa-envelope me-2"></i> support@shoplocate.com</p>
                    <p><i class="fas fa-phone me-2"></i> +91 9876543210</p>
                </div>
            </div>
            <hr class="my-4 bg-light">
            <div class="text-center">
                <p class="mb-0">&copy; 2023 ShopLocate. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const searchData = JSON.parse(localStorage.getItem('shopLocateResults'));
            
            if (!searchData) {
                window.location.href = "index.html";
                return;
            }
            
            // Display search criteria
            document.getElementById('resultsHeading').textContent = 
                `Best Locations for ${searchData.businessType} in ${searchData.city}`;
            
            // Display results with proper names
            displayResults(searchData.results);
            
            // Initialize map
            initResultsMap(searchData.results);
        });

        function displayResults(results) {
            const container = document.getElementById('resultsContainer');
            container.innerHTML = '';
            
            results.forEach((result, index) => {
                const card = document.createElement('div');
                card.className = 'col-md-6 col-lg-4 mb-4';
                
                // Prepare landmarks text if available
                const landmarksText = result.landmarks?.length > 0 
                    ? `<p class="text-muted small mb-2">
                          <i class="fas fa-landmark"></i> Near: ${result.landmarks.map(l => l.name).join(', ')}
                       </p>`
                    : '';
                
                card.innerHTML = `
                    <div class="card h-100">
                        <div class="card-header bg-white border-bottom-0">
                            <h5 class="mb-0">${index + 1}. ${result.name}</h5>
                        </div>
                        <div class="card-body">
                            <p class="text-muted">
                                <i class="fas fa-map-marker-alt"></i> ${result.address}
                            </p>
                            ${landmarksText}
                            <div class="d-flex justify-content-between mb-2">
                                <span><i class="fas fa-store"></i> Similar Businesses:</span>
                                <span class="badge bg-${getCompetitionColor(result.competitorCount)}">
                                    ${result.competitorCount}
                                </span>
                            </div>
                            <div class="d-flex justify-content-between mb-3">
                                <span><i class="fas fa-money-bill-wave"></i> Est. Rent:</span>
                                <span class="fw-bold">${estimateRent(result.opportunityScore)}</span>
                            </div>
                            <a href="https://www.google.com/maps/?q=${result.center.lat},${result.center.lng}" 
                               class="btn btn-sm btn-primary w-100" target="_blank">
                                <i class="fas fa-map-marked-alt"></i> View on Map
                            </a>
                        </div>
                    </div>
                `;
                container.appendChild(card);
            });
        }
        // Configuration
        const API_KEY = 'AlzaSyzah-Sk-aToMazpSgl7pAt6qzytnQyL2nd';
        const INITIAL_DISPLAY_COUNT = 3;
        
        document.addEventListener('DOMContentLoaded', function() {
            const searchData = JSON.parse(localStorage.getItem('shopLocateResults'));
            
            if (!searchData) {
                window.location.href = "index.html";
                return;
            }
            
            // Display search criteria
            document.getElementById('resultsHeading').textContent = 
                `Best Locations for ${searchData.businessType} in ${searchData.city}`;
            document.getElementById('searchCriteria').textContent = 
                `Sorted by locations with fewest competitors`;
            
            // Process and display results
            processAndDisplayResults(searchData.results);
        });

        function processAndDisplayResults(locations) {
            if (!locations || locations.length === 0) {
                document.getElementById('resultsContainer').innerHTML = `
                    <div class="col-12">
                        <div class="alert alert-warning">
                            No locations found matching your criteria. Please try a different search.
                        </div>
                    </div>
                `;
                return;
            }
            
            // Sort locations by competitor count (ascending)
            locations.sort((a, b) => a.competitorCount - b.competitorCount);
            
            // Update main map
            updateMainMap(locations);
            
            // Display initial locations
            const resultsContainer = document.getElementById('resultsContainer');
            resultsContainer.innerHTML = '';
            
            // Show first few locations
            locations.slice(0, INITIAL_DISPLAY_COUNT).forEach((location, index) => {
                resultsContainer.appendChild(createLocationCard(location, index));
            });
            
            // Show remaining locations in hidden section
            const moreResultsContainer = document.getElementById('moreResultsContainer');
            moreResultsContainer.innerHTML = '';
            
            if (locations.length > INITIAL_DISPLAY_COUNT) {
                locations.slice(INITIAL_DISPLAY_COUNT).forEach((location, index) => {
                    moreResultsContainer.appendChild(createLocationCard(location, index + INITIAL_DISPLAY_COUNT));
                });
            } else {
                document.getElementById('seeMoreBtn').style.display = 'none';
            }
        }

        function createLocationCard(location, index) {
            const competitionLevel = getCompetitionLevel(location.competitorCount);
            const competitionColor = getCompetitionColor(location.competitorCount);
            
            const col = document.createElement('div');
            col.className = 'col-md-6 col-lg-4';
            col.innerHTML = `
                <div class="card h-100">
                    <div class="position-relative">
                        <img src="https://maps.gomaps.pro/maps/api/staticmap?center=${location.lat},${location.lng}&zoom=16&size=600x300&maptype=roadmap&markers=color:0x${getColorHex(competitionColor)}%7C${location.lat},${location.lng}&key=${API_KEY}" 
                             class="map-static" alt="${location.name}">
                        <span class="competition-badge badge bg-${competitionColor}">
                            ${competitionLevel} Competition
                        </span>
                    </div>
                    <div class="card-body">
                        <h5 class="card-title">${index + 1}. ${location.name}</h5>
                        <p class="card-text text-muted">
                            <i class="fas fa-map-marker-alt"></i> ${location.address}
                        </p>
                        
                        <div class="mb-3">
                            <div class="d-flex justify-content-between mb-2">
                                <span><i class="fas fa-store-alt"></i> Similar Businesses:</span>
                                <span class="fw-bold">${location.competitorCount} within 1km</span>
                            </div>
                            <div class="d-flex justify-content-between">
                                <span><i class="fas fa-money-bill-wave"></i> Est. Rent:</span>
                                <span class="fw-bold">${location.rent}</span>
                            </div>
                        </div>
                        
                        <div class="d-flex justify-content-between">
                            <a href="https://maps.gomaps.pro/?q=${encodeURIComponent(location.name)}&center=${location.lat},${location.lng}&zoom=16" 
                               class="btn btn-sm btn-outline-primary" target="_blank">
                                <i class="fas fa-map-marked-alt"></i> View Area
                            </a>
                            <button class="btn btn-sm btn-outline-secondary save-btn" data-location='${JSON.stringify(location)}'>
                                <i class="fas fa-bookmark"></i> Save
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            // Add event listener to save button
            col.querySelector('.save-btn').addEventListener('click', function() {
                const location = JSON.parse(this.dataset.location);
                saveLocation(location);
            });
            
            return col;
        }

        function updateMainMap(locations) {
            const mapContainer = document.getElementById('resultsMap');
            
            if (locations.length === 0) {
                mapContainer.innerHTML = '<div class="alert alert-warning m-3">No locations to display</div>';
                return;
            }
            
            // Create a static map with all locations marked
            const markers = locations.map(loc => {
                const color = getColorHex(getCompetitionColor(loc.competitorCount));
                return `color:0x${color}%7C${loc.lat},${loc.lng}`;
            }).join('|');
            
            const center = locations[0]; // Center on first (best) location
            
            mapContainer.innerHTML = `
                <img src="https://maps.gomaps.pro/maps/api/staticmap?center=${center.lat},${center.lng}&zoom=14&size=1200x600&maptype=roadmap&markers=${markers}&key=${API_KEY}" 
                     class="map-static" alt="Recommended Locations">
            `;
        }

        function getCompetitionLevel(count) {
            if (count < 3) return 'Very Low';
            if (count < 6) return 'Low';
            if (count < 10) return 'Moderate';
            return 'High';
        }

        function getCompetitionColor(count) {
            if (count < 3) return 'success';
            if (count < 6) return 'primary';
            if (count < 10) return 'warning';
            return 'danger';
        }

        function getColorHex(color) {
            switch(color) {
                case 'success': return '28a745';
                case 'primary': return '3498db';
                case 'warning': return 'ffc107';
                case 'danger': return 'dc3545';
                default: return '3498db';
            }
        }

        function saveLocation(location) {
            // In a real app, you would save to a database or localStorage
            console.log('Saving location:', location);
            alert(`Saved location: ${location.name}\nOnly ${location.competitorCount} competitors in 1km radius`);
        }
    </script>
</body>
</html>